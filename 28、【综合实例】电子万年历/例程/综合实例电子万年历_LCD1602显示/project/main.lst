C51 COMPILER V9.00   MAIN                                                                  08/03/2019 22:35:14 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN ..\output\main.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE ..\source\main.c PRINT(.\main.lst) OBJECT(..\output\main.obj)

line level    source

   1          /*********************************************************************************
   2          * ¡¾ÊµÑéÆ½Ì¨¡¿£º QX-MCS51 µ¥Æ¬»ú¿ª·¢°å
   3          * ¡¾Íâ²¿¾§Õñ¡¿£º 11.0592mhz     
   4          * ¡¾Ö÷¿ØÐ¾Æ¬¡¿£º STC89C52
   5          * ¡¾±àÒë»·¾³¡¿£º Keil ¦ÌVisio4  
   6          * ¡¾³ÌÐò¹¦ÄÜ¡¿£º µç×ÓÍòÄêÀú,LCD1602Òº¾§ÏÔÊ¾£¬ÏÔÊ¾Ê±·ÖÃë¡¢ÐÇÆÚ¡¢¹«Àú¡¢ÒõÀú¡¢ÄÖÖÓ¡¢»·¾³ÎÂ¶È¡¢¿ÉÒÔÐ£Ê±ºÍÉèÖÃÄ
             -ÖÖÓ¡£                                                                                    
   7          * ¡¾Ê¹ÓÃËµÃ÷¡¿£º Ê¹ÓÃ3Ìõ¶Å°îÏß°ÑP10½Óµ½DS1302µÄTSCLKÉÏ£¬P11½Óµ½TIO£¬P12½Óµ½TRSTÉÏ¡£
   8                                           ½ÓÉÏLCD1602Òº¾§¡£
   9          * ¡¾°´¼ü¹¦ÄÜËµÃ÷¡¿£ºÔÚÕý³£ÏÔÊ¾×´Ì¬ÏÂS2°´¼üÎªÇÐ»»¹«Àú¡¢Ê±ÖÓ/ÒõÀú¡¢ÄÖÖÓÏÔÊ¾£¬ÔÚÉèÖÃ×´Ì¬ÏÂS2ÎªÉèÖÃ×óÒÆ¡£
  10                                                  S5ÎªÉèÖÃ¼ü£¬ÔÚÏÔÊ¾¹«ÀúÊ±ÖÓ×´Ì¬ÏÂ£¬°´ÏÂS5ÎªÉèÖÃ¹«Àú¡¢Ê±ÖÓ£¬ÔÙ´Î°´ÏÂS5ÎªÐ´ÈëÉèÖÃ²ÎÊý²¢ÍË³ö
  11                                                  ÔÚÏÔÊ¾ÒõÀú¡¢ÄÖÖÓ×´Ì¬ÏÂ£¬°´ÏÂS5ÎªÉèÖÃÒõÀú¡¢ÄÖÖÓ£¬ÔÙ´Î°´ÏÂS5ÎªÐ´ÈëÉèÖÃ²ÎÊý²¢ÍË³ö
  12                                                  ÔÚÉèÖÃ×´Ì¬ÏÂ£¬S3ÎªÊý¾Ý¼Ó
  13                                                  ÔÚÉèÖÃ×´Ì¬ÏÂ£¬S4ÎªÊý¾Ý¼õ
  14          *  ËµÃ÷£ºÃâ·Ñ¿ªÔ´£¬²»Ìá¹©Ô´´úÂë·ÖÎö.
  15          **********************************************************************************/
  16          #define  _MAIN_C
  17          #include "config.h"
  18          #include "LCD1602.h"
  19          #include "DS1302.h"
  20          #include "DS18B20.h"
  21          #include "app.h"
  22          #include "Key_Buzzer.h"
  23          #include "main.h"
  24          
  25          bit flag1s = 0;    //1s¶¨Ê±±êÖ¾Î»
  26          bit flag200ms = 0; //200ms¶¨Ê±±êÖ¾
  27          enum eStaSystem staSystem = E_NORMAL;  //ÏµÍ³ÔËÐÐ×´Ì¬
  28          
  29          void main()
  30          {
  31   1              EA = 1;                 //¿ª×ÜÖÐ¶Ï
  32   1              Start18B20();   //Æô¶¯ÎÂ¶È×ª»»
  33   1              Init_Timer0();  //³õÊ¼»¯¶¨Ê±Æ÷0
  34   1              Init_LCD1602(); //LCD1602³õÊ¼»¯
  35   1              Init_DS1302();  //³õÊ¼»¯DS1302
  36   1              while (!flag1s);//ÉÏµçºóÑÓÊ±1Ãë
  37   1          flag1s = 0;
  38   1              RefreshTime();  //Ë¢ÐÂÊ±¼ä
  39   1              RefreshDate(1); //Á¢¼´Ë¢ÐÂÈÕÆÚ
  40   1              RefreshTemp(1); //Á¢¼´Ë¢ÐÂÎÂ¶ÈÏÔÊ¾
  41   1      
  42   1              while(1)
  43   1              {
  44   2                  KeyDriver();        //°´¼ü¼ì²â
  45   2                      if(flag200ms)   //200msÊ±¼äµ½
  46   2                      {
  47   3                              flag200ms = 0;  //ÇåÁã±êÖ¾Î»
  48   3                              AlarmMonitor(); //¼à¿ØÄÖÖÓ
  49   3                              if (staSystem == E_NORMAL)//Èç¹ûÏµÍ³Õý³£ÔËÐÐ
  50   3                              {
  51   4                                      RefreshTime(); //Ë¢ÐÂÊ±¼ä
  52   4                                      RefreshDate(0);//Ë¢ÐÂÈÕÆÚ
  53   4                              }
  54   3                              if (staSystem == Dis_Alarm)
C51 COMPILER V9.00   MAIN                                                                  08/03/2019 22:35:14 PAGE 2   

  55   3                              {
  56   4                                      RefreshLunar(); //Ë¢ÐÂÒõÀú
  57   4                              }
  58   3                      }       
  59   2                      if(flag1s && (staSystem == E_NORMAL))//1sÊ±¼äµ½²¢ÇÒÏµÍ³ÎªÕý³£ÔËÐÐ
  60   2                      {
  61   3                              flag1s = 0;//ÇåÁã±êÖ¾Î»
  62   3                              RefreshTemp(0);//Ë¢ÐÂÎÂ¶È       
  63   3                      }
  64   2         }
  65   1      }
  66          
  67          /* ÎÂ¶ÈË¢ÐÂº¯Êý£¬¶ÁÈ¡µ±Ç°ÎÂ¶È²¢¸ù¾ÝÐèÒªË¢ÐÂÒº¾§ÏÔÊ¾£¬
  68          ** ops-Ë¢ÐÂÑ¡Ïî£ºÎª0Ê±Ö»µ±ÎÂ¶È±ä»¯²ÅË¢ÐÂ£¬·Ç0ÔòÁ¢¼´Ë¢ÐÂ */
  69          void RefreshTemp(uint8 ops)
  70          {
  71   1          int16 temp;
  72   1          uint8 pdata str[8];
  73   1          static int16 backup = 0;
  74   1          
  75   1          Get18B20Temp(&temp); //»ñÈ¡µ±Ç°ÎÂ¶ÈÖµ
  76   1          Start18B20();        //Æô¶¯ÏÂÒ»´Î×ª»»
  77   1          temp >>= 4;          //ÉáÆú4bitÐ¡ÊýÎ»
  78   1          if ((backup!=temp) || (ops!=0)) //°´ÐèÒªË¢ÐÂÒº¾§ÏÔÊ¾
  79   1          {
  80   2              str[0] = (temp / 10) + '0';  //Ê®Î»×ªÎªASCIIÂë
  81   2              str[1] = (temp % 10) + '0';  //¸öÎ»×ªÎªASCIIÂë
  82   2              str[2] = '\'';             //ÓÃ'C´úÌæ¡æ
  83   2              str[3] = 'C';
  84   2              str[4] = '\0';             //×Ö·û´®½áÊø·û
  85   2              LCD1602_Dis_Str(12, 1, str);    //ÏÔÊ¾µ½Òº¾§ÉÏ
  86   2              backup = temp;             //Ë¢ÐÂÉÏ´ÎÎÂ¶ÈÖµ
  87   2          }
  88   1      }
  89          
  90          
  91          /*³õÊ¼»¯¶¨Ê±Æ÷0 ¶¨Ê±5ms*/       
  92          void Init_Timer0()
  93          {
  94   1              
  95   1              TMOD = 0x01;  //¶¨Ê±Æ÷16Îª¼ÆÊý¹¤×÷Ä£Ê½
  96   1              TH0 =0xee;
  97   1              TL0 =0x00; //5ms
  98   1              ET0 = 1; //¿ª¶¨Ê±Æ÷0ÖÐ¶Ï
  99   1              TR0 = 1;//Æô¶¯¶¨Ê±Æ÷0
 100   1      }
 101          /*¶¨Ê±Æ÷0ÖÐ¶Ï·þÎñ³ÌÐò*/
 102          void Timer0() interrupt 1
 103          {
 104   1              static uint8 tmr1s = 0;
 105   1          static uint8 tmr200ms = 0;
 106   1              
 107   1              TH0 =0xee;
 108   1              TL0 =0x00; //5ms
 109   1              tmr200ms++;  //¶¨Ê±200ms
 110   1          if (tmr200ms >= 40)
 111   1          {
 112   2              tmr200ms = 0;
 113   2              flag200ms = 1;
 114   2              tmr1s++;  //¶¨Ê±1s
 115   2              if (tmr1s >= 5)
 116   2              {
C51 COMPILER V9.00   MAIN                                                                  08/03/2019 22:35:14 PAGE 3   

 117   3                  tmr1s = 0;
 118   3                  flag1s = 1;
 119   3              }
 120   2          }
 121   1              KeyScan();//°´¼üÉ¨Ãè
 122   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    293    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----       8
   DATA SIZE        =      5       3
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      2    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
