C51 COMPILER V9.00   MAIN                                                                  02/23/2018 16:57:28 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /*********************************************************************************
   2          * 【作    者】：        清翔电子:向量
   3          * 【版    本】：        V1.0
   4          * 【网    站】：        http://www.qxmcu.com/ 
   5          * 【淘宝店铺】：        http://qxmcu.taobao.com/
   6          * 【实验平台】：        清翔 QX-MCS51 单片机开发板
   7          * 【外部晶振】：        11.0592mhz      
   8          * 【主控芯片】：        STC89C52
   9          * 【编译环境】：        Keil μVisio4   
  10          * 【程序功能】：        串口工作方式1,8位UART比特率9600。接收串口数据，数码管以十进制格
  11                                                  式显示，并且把接收到的数据加1后通过串口发出                                                                         
  12          * 【使用说明】：        打开串口助手（STC-ISP软件上有集成）选择对应COM号，设置波特率9600
  13                                                  发送和接收格式选择HEX格式。
  14          **********************************************************************************/
  15          #include <reg52.h>
  16          #include <intrins.h>
  17          
  18          #define uint unsigned int
  19          #define uchar unsigned char
  20          
  21          sbit DU = P2^6;//数码管段选
  22          sbit WE = P2^7;//数码管段选
  23          uchar num;//数码管显示的值
  24          
  25          //共阴数码管段选表0-9
  26          uchar code SMGduan[]= {0x3F, 0x06, 0x5B, 0x4F, 0x66, 0x6D, 0x7D, 0x07, 0x7F, 0x6F,};
  27          //数码管位选码
  28          uchar code SMGwei[] = {0xfe, 0xfd, 0xfb};
  29          
  30          /*====================================
  31          函数    ： delay(uint z)
  32          参数    ：z 延时毫秒设定，取值范围0-65535
  33          返回值  ：无
  34          描述    ：12T/Fosc11.0592M毫秒级延时
  35          ====================================*/
  36          //void delay(uint z)
  37          //{
  38          //      uint x,y;
  39          //      for(x = z; x > 0; x--)
  40          //              for(y = 114; y > 0 ; y--);              
  41          //} 
  42          
  43          /*====================================
  44          函数    ：display(uchar i)
  45          参数    ：i 显示数值，取值范围0-255
  46          返回值  ：无
  47          描述    ：三位共阴数码管动态显示
  48          ====================================*/
  49          void display(uchar i)
  50          {
  51   1              static uchar wei;               
  52   1              P0 = 0XFF;//清除断码
  53   1              WE = 1;//打开位选锁存器
  54   1              P0 = SMGwei[wei];
  55   1              WE = 0;//锁存位选数据
C51 COMPILER V9.00   MAIN                                                                  02/23/2018 16:57:28 PAGE 2   

  56   1              switch(wei)
  57   1              {
  58   2                      case 0: DU = 1; P0 = SMGduan[i / 100]; DU = 0; break;
  59   2                      case 1: DU = 1; P0 = SMGduan[i % 100 / 10]; DU = 0; break;      
  60   2                      case 2: DU = 1; P0 = SMGduan[i % 10]; DU = 0; break;            
  61   2              }
  62   1              wei++;
  63   1              if(wei == 3)
  64   1                      wei = 0;
  65   1      }
  66          //定时器0初始化
  67          void timer0Init()
  68          {
  69   1              EA = 1; //打开总中断
  70   1              ET0 = 1;//打开定时器0中断
  71   1              TR0 = 1;         //启动定时器0
  72   1              REN = 1;//允许串口接收
  73   1              TMOD |= 0X01; //定时器工作模式1，16位定时模式
  74   1              TH0 = 0xED;
  75   1              TL0 = 0xFF; //定时5ms
  76   1      }
  77          //串口初始化
  78          void UARTInit()
  79          {
  80   1              EA = 1; //打开总中断
  81   1              ES = 1; //打开串口中断
  82   1              SM0 = 0;        SM1 = 1;//串口工作方式1,8位UART波特率可变
  83   1              REN = 1;//串口允许接收
  84   1              TR1 = 1;//启动定时器1
  85   1              TMOD |= 0x20;//定时器1，工作模式2 8位自动重装
  86   1              TH1 = 0xfd;
  87   1              TL1 = 0xfd;//设置比特率9600
  88   1      }
  89          void main()//main函数自身会循环
  90          {       
  91   1              timer0Init();//定时器0初始化
  92   1              UARTInit();//串口初始化
  93   1              while(1);       
  94   1      } 
  95          
  96          //定时器0中断函数
  97          void timer0() interrupt 1
  98          {
  99   1              TH0 = 0xED;
 100   1              TL0 = 0xFF; //定时5ms
 101   1              display(num); //数码管显示函数  
 102   1      }
 103          //串口中断函数
 104          void UART() interrupt 4
 105          {
 106   1              uchar temp;
 107   1              if(RI)//判断接收是否完成
 108   1              {
 109   2                      num = SBUF;//读SBUF，读出串口接收到的数据
 110   2                      RI = 0;//软件清零接收标志位     
 111   2                      temp = num;//
 112   2                      SBUF = ++temp;//写SBUF，把要发送的数据送给发送缓存器
 113   2              }
 114   1              if(TI)//判断是否发送完成
 115   1                      TI = 0;//清零发送完成标志位     
 116   1      } 

C51 COMPILER V9.00   MAIN                                                                  02/23/2018 16:57:28 PAGE 3   


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    195    ----
   CONSTANT SIZE    =     13    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
