C51 COMPILER V9.00   MAIN                                                                  08/18/2017 17:13:31 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /*
   2          ****************枚举变量的定义与引用************************
   3          打开串口后比特率设置为9600
   4          接收模式为文本模式
   5          */
   6          #include <reg52.h>
   7          #include <stdio.h>
   8          
   9          enum eStaSystem {  //枚举类型定义
  10              DIS_DATE, DIS_TIME
  11          };
  12          //系统运行状态
  13          enum eStaSystem staSystem = DIS_TIME;  //枚举变量定义与赋值
  14          /*毫秒级延时函数*/
  15          void Delay_Ms(unsigned int z)
  16          {
  17   1              unsigned int x,y;
  18   1              for(x = z; x > 0; x--)
  19   1                      for(y = 114; y > 0 ; y--);
  20   1      }       
  21          /*串口初始化，比特率9600*/
  22          void UART_Init()
  23          {
  24   1              TMOD |= 0x20;   //T1工作模式2  8位自动重装
  25   1              TH1 = 0xfd;
  26   1              TL1 = 0xfd;     //比特率9600
  27   1              TR1 = 1;                //启动T1定时器
  28   1              SM0 = 0;
  29   1              SM1 = 1;                //串口工作方式1 10位异步
  30   1      }
  31          
  32          void main()
  33          {
  34   1              UART_Init(); //串口初始化
  35   1              TI = 1;//使用printf()puts()前都应软件置位TI = 1；
  36   1              while(1)
  37   1              {
  38   2                      if (staSystem == DIS_DATE)
  39   2                      {
  40   3                              printf("日期：2017-8-8 \n");
  41   3                      }
  42   2                      if (staSystem == DIS_TIME)
  43   2                      {
  44   3                              printf("时间：08:30:50 \n");
  45   3                      }
  46   2                      Delay_Ms(5000);//5秒发送一次
  47   2              }       
  48   1      }
  49          /*************************************
  50          备注：
  51          使用printf()puts()前都应软件置位TI = 1；
  52          printf()puts()  使用putchar函数发送字节
  53          
  54          void putchar(uchar sbyte )
  55          {
C51 COMPILER V9.00   MAIN                                                                  08/18/2017 17:13:31 PAGE 2   

  56              while(！TI);   //等待发送完
  57          
  58              SBUF=sbyte;
  59          
  60          }
  61          
  62          所第调用putchar前没TI=1 永远等待
  63          *************************************/


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     87    ----
   CONSTANT SIZE    =     34    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      1    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
