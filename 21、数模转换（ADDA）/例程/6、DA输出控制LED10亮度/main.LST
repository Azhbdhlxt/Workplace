C51 COMPILER V9.00   MAIN                                                                  05/21/2019 13:46:21 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /*********************************************************************************
   2          * 【编写时间】： 2019年5月21日
   3          * 【作    者】： 清翔电子:03
   4          * 【版    本】： 1.0
   5          * 【网    站】： http://www.qxmcu.com/ 
   6          * 【淘宝店铺】： http://qxmcu.taobao.com/ (直销店)
   7          * 【实验平台】： QX-MCS51 单片机开发板 & QX-A51智能小车
   8          * 【外部晶振】： 11.0592mhz     
   9          * 【主控芯片】： STC89C52
  10          * 【编译环境】： Keil μVisio4
  11          * 【程序功能】： QX-MCS51 单片机开发板DA输出                                                                        
  12          * 【使用说明】： 
  13          * 【注意事项】： 
  14          **********************************************************************************/
  15          #include <reg52.h>
  16          sfr P4 = 0xe8;  /*C语言中声明P4口特殊功能寄存器地址*/
  17          sbit DAC_DATA = P4^4;//DA数据口
  18          unsigned char DAC_VAL;//占空比参数 模拟8位DA输出，取值范围0-255
  19          unsigned char pwm_t;//周期
  20          
  21          #define MAIN_Fosc               11059200UL      //宏定义主时钟HZ
  22          typedef unsigned int INT16U;
  23          
  24          /*====================================
  25          函数名  ：void delay(INT16U ms)
  26          参数    ：ms，毫秒延时形参
  27          返回值  ：无
  28          描述    ：12T 51单片机自适应主时钟毫秒级延时函数
  29          ====================================*/
  30          void delay(INT16U ms)
  31          {
  32   1           INT16U i;
  33   1               do{
  34   2                    i = MAIN_Fosc / 96000; 
  35   2                        while(--i);   //96T per loop
  36   2           }while(--ms);
  37   1      }
  38          //定时器0中断
  39          void timer0() interrupt 1
  40          {
  41   1              pwm_t++;//周期自加到255溢出后自动归零
  42   1              if(pwm_t <= DAC_VAL)// 设置占空比
  43   1                      DAC_DATA = 1;
  44   1              else
  45   1                      DAC_DATA = 0;                    
  46   1      }
  47          void main()
  48          {
  49   1              bit flag = 0;
  50   1              TMOD |= 0x02;//8位自动重装模块
  51   1              TH0 = 220;
  52   1              TL0 = 220;//11.0592M晶振下占空比最大比值是256,输出100HZ
  53   1              TR0 = 1;//启动定时器0
  54   1              ET0 = 1;//允许定时器0中断
  55   1              EA      = 1;//总中断允许
C51 COMPILER V9.00   MAIN                                                                  05/21/2019 13:46:21 PAGE 2   

  56   1      //      DAC_VAL = 169; //输出3.3V (一个数字量理论表示输出0.01953125V)
  57   1              DAC_VAL = 80;//LED10灯点亮最低电压
  58   1              while(1)
  59   1              {
  60   2                      delay(5);
  61   2                      if(DAC_VAL == 255)
  62   2                                 flag = 1;
  63   2                                 else if(DAC_VAL == 80)
  64   2                                                 flag = 0;
  65   2                      if((DAC_VAL < 255) && (flag == 0))
  66   2                              DAC_VAL++;
  67   2                              else if((DAC_VAL > 80) && (flag == 1))
  68   2                                               DAC_VAL--;
  69   2                                      
  70   2              }
  71   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    118    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       1
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
