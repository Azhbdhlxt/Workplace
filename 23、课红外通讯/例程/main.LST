C51 COMPILER V8.08   MAIN                                                                  02/12/2016 13:23:15 PAGE 1   


C51 COMPILER V8.08, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /*NECЭͨ
   2          Ƭͨ9600ıʷͳȥ
   3          */
   4          
   5          #include <reg52.h>
   6          
   7          /*====================================
   8           Զ
   9          ====================================*/
  10          typedef unsigned char INT8U;
  11          typedef unsigned char uchar;
  12          
  13          typedef unsigned int INT16U;
  14          typedef unsigned int uint;
  15          
  16          /*====================================
  17           Ӳӿλ
  18          ====================================*/
  19          sbit IR  = P3^2;     //ݽӿ     ⲿжO
  20          
  21          uchar IRtime;           //ߵƽʱ䣨
  22          uchar IRcord[4];    //ڴ4ֽڵݣû2ֽ+ֵ2ֽڣ
  23          uchar IRdata[33];   //ڴ33λݣһλΪû16+ֵ16
  24          bit IRpro_ok, IRok;  //һں4ֽϡIRokΪ
  25          
  26          void init()        //ʼʱ0 ⲿж0
  27          {
  28   1              TMOD = 0x22; //ʱ0Ͷʱ1ʽ28λԶװ
  29   1              TH0 = 0x00;  //8λװ0ôʱһεʱ256
  30   1              TL0 = 0x00;
  31   1              EA = 1;      //ж
  32   1              ET0 = 1;           //ʱ0ж
  33   1              TR0 = 1;     //ʱ0
  34   1      
  35   1              IT0 = 1;           //ⲿж0Ϊشʽһ½شһ
  36   1              EX0 = 1;           //ⲿж0
  37   1      
  38   1              TH1 = 0xfd;  //Ϊ9600
  39   1              TL1 = 0xfd;
  40   1              TR1 = 1;     //ʱ1
  41   1              SM1 = 1;     //ôڹʽ110λ첽շ
  42   1      }
  43          
  44          void time0() interrupt 1   //嶨ʱ0
  45          {
  46   1              IRtime++;                          //1Ϊ278us
  47   1      }
  48          
  49          void int0() interrupt 0                 //ⲿж0
  50          {
  51   1              static uchar i;                         //      ̬ڻִеʱ򲻻ᶪʧֵiڰ33θߵƽĳʱ
             -IRdata
  52   1              static bit startflag;           //ʼ־λ
  53   1              if(startflag)                           //ʼ
  54   1              {
C51 COMPILER V8.08   MAIN                                                                  02/12/2016 13:23:15 PAGE 2   

  55   2                      if( (IRtime < 53) && (IRtime >= 32) ) /*жǷ룬׵ƽ9000us+4500us 
  56   2                      Լ11.0592NECЭ8000-10000+4000-5000 
  57   2                      Ѿôiᱻ0ͻῪʼδ*/
  58   2                              i = 0;                           //ôִi=0浽IRdataĵһλ
  59   2                      IRdata[i] = IRtime;              //T0ʱ浽浽ж
  60   2                      IRtime = 0;                              //㣬һ½صʱڴ
  61   2                      i++;                                     //Ĵ
  62   2                      if(i == 33)                              //34 ±Ǵ0ʼi33ʾִ34
  63   2                      {
  64   3                              IRok = 1;                                //ôʾ
  65   3                              i = 0;                           //׼´δ
  66   3                      }
  67   2              }
  68   1              else              
  69   1              {
  70   2                      IRtime = 0;                              //뿪ʼ㿪ʼ
  71   2                      startflag = 1;                   //ʼ־λ1
  72   2              }
  73   1      }
  74          
  75          void IRcordpro()                                 //ȡ33ݽ
  76          {
  77   1              uchar i, j, k, cord, value;     /*iڴ4ֽڣjڴһֽÿһλk33еһλ
  78   1              cordȡʱжǷ1ʱ*/
  79   1              k = 1;                                          //ӵһλʼȡ
  80   1              for(i = 0; i < 4; i++)
  81   1              {
  82   2                      for(j = 0; j < 8; j++)
  83   2                      {
  84   3                              cord = IRdata[k];           //cord
  85   3                              if(cord > 5)                    //11.0592t0ΪԼ278us*5=1390ôжΪ1
  86   3                              value = value | 0x80;   /*յʱȽλ
  87   3                              λȷŵvalueλں0x08λһ
  88   3                              ıvaluaλֵֻλΪ1*/
  89   3                              if(j < 7)
  90   3                              {
  91   4                                      value = value >> 1;     //valueλν8λݡ
  92   4                              }
  93   3                              k++;                            //ÿִһλ1
  94   3                      }
  95   2                      IRcord[i] = value;         //ÿһֽڰIRcordС
  96   2                      value = 0;                         //value´ڴ
  97   2              }
  98   1              IRpro_ok = 1;                              //4ֽںIRpro ok1ʾ 
  99   1      }
 100          
 101          
 102          void main()
 103          {
 104   1              uchar i;
 105   1              init(); //ִгʼʱ0ⲿж0
 106   1              while(1)        //ѭ
 107   1              {
 108   2                      if(IRok)    //жǷ                    
 109   2                      {   
 110   3                              IRcordpro();//4ֽڵ
 111   3                              IRok = 0;       //µȴ
 112   3                              if(IRpro_ok) //жǷ  
 113   3                              {
 114   4                                      for(i = 0; i < 4; i++)  
 115   4                                      {        
 116   5                                              SBUF = IRcord[i];
C51 COMPILER V8.08   MAIN                                                                  02/12/2016 13:23:15 PAGE 3   

 117   5                                              while(!TI);
 118   5                                              TI = 0;
 119   5                                      }
 120   4                                      IRpro_ok = 0;
 121   4                              }
 122   3                      }       
 123   2              }
 124   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    182    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     39    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      3    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
